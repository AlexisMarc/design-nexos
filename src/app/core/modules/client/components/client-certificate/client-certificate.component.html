<div class="w-full h-fit flex flex-col gap-4 min-h-96">
    <div class="flex gap-4 items-center py-8">
        <div class="w-4 h-10 rounded-full bg-brand-orange-500"></div>
        <div class="flex flex-col flex-1">
            <span class="text-2xl text-neutral-900 font-black">Poderes</span>
            <span class="text-xs font-medium text-neutral-600">{{welcome?.residential_name}}</span>
        </div>
    </div>
    <div class="w-full px-2 flex md:items-center gap-4 md:flex-row flex-col-reverse">
        <span class="text-sm text-neutral-300 font-bold flex flex-1">Unidades seleccionadas</span>
        <button (click)="saveCertificate()" [disabled]="!this.unitsSelect.length" [ngStyle]="{borderColor: colors.primary, color: colors.primary}"
            class="b-tertiary px-4 py-1 w-full md:w-fit">Siguiente</button>
        <div class="w-full md:w-fit">
            <label for="input-group-search" class="sr-only">Buscar</label>
            <div class="relative">
                <div class="absolute inset-y-0 start-0 flex items-center ps-3 pointer-events-none">
                    <svg class="w-4 h-4 text-neutral-500" xmlns="http://www.w3.org/2000/svg" fill="none"
                        viewBox="0 0 20 20">
                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="m19 19-4-4m0-7A7 7 0 1 1 1 8a7 7 0 0 1 14 0Z" />
                    </svg>
                </div>
                <input #filter type="text" id="input-group-search"
                    class="block w-full p-2 ps-10 text-sm text-neutral-900 bg-neutral-50 shadow rounded-2xl focus-visible:outline-brand-orange-500 focus:ring-brand-orange-500 focus:border-brand-orange-500"
                    placeholder="Buscar...">
            </div>
        </div>
    </div>
    <div class="w-full max-w-4xl rounded-2xl bg-white/50 backdrop-blur-md shadow overflow-hidden">
        <ng-scrollbar [orientation]="'vertical'" style="max-height: calc(100svh - 16rem);">
            <table class="w-full table-fixed">
                <tbody>
                    @for (unit of unitsSelect; track $index) {
                    <ng-container [ngTemplateOutlet]="TrCertificate"
                        [ngTemplateOutletContext]="{unit, index: $index}"></ng-container>
                    }
                </tbody>
            </table>
        </ng-scrollbar>
    </div>
</div>

<ng-template #TrCertificate let-unit="unit">
    @if (certificate[unit.id]) {
    <tr class="rounded even:bg-neutral-100/25 bg-neutral-100 flex justify-between">
        <td class="pl-4">
            <div class="flex gap-2 items-center w-ful p-1">
                <div class="rounded-full bg-brand-green-500 md:bg-transparent p-1 md:p-0">
                    <svg class="w-10 h-10 fill-brand-orange-500 md:block hidden" viewBox="0 0 40 41" fill="none"
                        xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M13.3333 33.8333C12.4167 33.8333 11.6319 33.5069 10.9792 32.8541C10.3264 32.2013 10 31.4166 10 30.5V25.5H15V21.75C14.0278 21.6944 13.1042 21.4791 12.2292 21.1041C11.3542 20.7291 10.5556 20.1666 9.83333 19.4166V17.5833H7.91667L2.5 12.1666C3.5 10.8888 4.73611 9.98607 6.20833 9.45829C7.68056 8.93051 9.16667 8.66663 10.6667 8.66663C11.4167 8.66663 12.1458 8.72218 12.8542 8.83329C13.5625 8.9444 14.2778 9.15274 15 9.45829V7.16663H35V28.8333C35 30.2222 34.5139 31.4027 33.5417 32.375C32.5694 33.3472 31.3889 33.8333 30 33.8333H13.3333ZM18.3333 25.5H28.3333V28.8333C28.3333 29.3055 28.4931 29.7013 28.8125 30.0208C29.1319 30.3402 29.5278 30.5 30 30.5C30.4722 30.5 30.8681 30.3402 31.1875 30.0208C31.5069 29.7013 31.6667 29.3055 31.6667 28.8333V10.5H18.3333V11.5L28.3333 21.5V23.8333H26L21.25 19.0833L20.9167 19.4166C20.5278 19.8055 20.1181 20.1527 19.6875 20.4583C19.2569 20.7638 18.8056 21 18.3333 21.1666V25.5ZM9.33333 14.25H13.1667V17.8333C13.5 18.0555 13.8472 18.2083 14.2083 18.2916C14.5694 18.375 14.9444 18.4166 15.3333 18.4166C15.9722 18.4166 16.5486 18.3194 17.0625 18.125C17.5764 17.9305 18.0833 17.5833 18.5833 17.0833L18.9167 16.75L16.5833 14.4166C15.7778 13.6111 14.875 13.0069 13.875 12.6041C12.875 12.2013 11.8056 12 10.6667 12C10.1111 12 9.58333 12.0416 9.08333 12.125C8.58333 12.2083 8.08333 12.3333 7.58333 12.5L9.33333 14.25ZM25 28.8333H13.3333V30.5H25.25C25.1667 30.25 25.1042 29.9861 25.0625 29.7083C25.0208 29.4305 25 29.1388 25 28.8333Z" />
                    </svg>
                    <svg class="w-6 h-6 fill-white md:hidden" viewBox="0 0 24 25" fill="none"
                        xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M10.35 17.5L16 11.85L14.55 10.4L10.325 14.625L8.225 12.525L6.8 13.95L10.35 17.5ZM6.5 20.5C4.98333 20.5 3.6875 19.975 2.6125 18.925C1.5375 17.875 1 16.5917 1 15.075C1 13.775 1.39167 12.6167 2.175 11.6C2.95833 10.5833 3.98333 9.93333 5.25 9.65C5.66667 8.11667 6.5 6.875 7.75 5.925C9 4.975 10.4167 4.5 12 4.5C13.95 4.5 15.6042 5.17917 16.9625 6.5375C18.3208 7.89583 19 9.55 19 11.5C20.15 11.6333 21.1042 12.1292 21.8625 12.9875C22.6208 13.8458 23 14.85 23 16C23 17.25 22.5625 18.3125 21.6875 19.1875C20.8125 20.0625 19.75 20.5 18.5 20.5H6.5ZM6.5 18.5H18.5C19.2 18.5 19.7917 18.2583 20.275 17.775C20.7583 17.2917 21 16.7 21 16C21 15.3 20.7583 14.7083 20.275 14.225C19.7917 13.7417 19.2 13.5 18.5 13.5H17V11.5C17 10.1167 16.5125 8.9375 15.5375 7.9625C14.5625 6.9875 13.3833 6.5 12 6.5C10.6167 6.5 9.4375 6.9875 8.4625 7.9625C7.4875 8.9375 7 10.1167 7 11.5H6.5C5.53333 11.5 4.70833 11.8417 4.025 12.525C3.34167 13.2083 3 14.0333 3 15C3 15.9667 3.34167 16.7917 4.025 17.475C4.70833 18.1583 5.53333 18.5 6.5 18.5Z" />
                    </svg>
                </div>
                <div class="flex flex-col">
                    <span class="text-sm text-neutral-700 font-medium">{{unit.name}}</span>
                    <span class="text-xs text-neutral-500">Apoderado</span>
                </div>
            </div>
        </td>
        <td class="pr-4">
            <div class="flex  gap-4 items-center justify-end p-1">
                <div
                    class="hidden md:flex h-fit items-center rounded-full bg-brand-green-300 text-white text-sm px-4 py-1 gap-2">
                    <svg class="w-6 h-6 fill-white" viewBox="0 0 24 25" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M10.35 17.5L16 11.85L14.55 10.4L10.325 14.625L8.225 12.525L6.8 13.95L10.35 17.5ZM6.5 20.5C4.98333 20.5 3.6875 19.975 2.6125 18.925C1.5375 17.875 1 16.5917 1 15.075C1 13.775 1.39167 12.6167 2.175 11.6C2.95833 10.5833 3.98333 9.93333 5.25 9.65C5.66667 8.11667 6.5 6.875 7.75 5.925C9 4.975 10.4167 4.5 12 4.5C13.95 4.5 15.6042 5.17917 16.9625 6.5375C18.3208 7.89583 19 9.55 19 11.5C20.15 11.6333 21.1042 12.1292 21.8625 12.9875C22.6208 13.8458 23 14.85 23 16C23 17.25 22.5625 18.3125 21.6875 19.1875C20.8125 20.0625 19.75 20.5 18.5 20.5H6.5ZM6.5 18.5H18.5C19.2 18.5 19.7917 18.2583 20.275 17.775C20.7583 17.2917 21 16.7 21 16C21 15.3 20.7583 14.7083 20.275 14.225C19.7917 13.7417 19.2 13.5 18.5 13.5H17V11.5C17 10.1167 16.5125 8.9375 15.5375 7.9625C14.5625 6.9875 13.3833 6.5 12 6.5C10.6167 6.5 9.4375 6.9875 8.4625 7.9625C7.4875 8.9375 7 10.1167 7 11.5H6.5C5.53333 11.5 4.70833 11.8417 4.025 12.525C3.34167 13.2083 3 14.0333 3 15C3 15.9667 3.34167 16.7917 4.025 17.475C4.70833 18.1583 5.53333 18.5 6.5 18.5Z" />
                    </svg>
                    <span>Cargado</span>
                </div>
                <button type="button" (click)="clearCertificate(unit.id)" [ngStyle]="{backgroundColor: colors.primary}" class="b-primary p-2">
                    <svg class="w-4 h-4 fill-neutral-50" xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960">
                        <path
                            d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z" />
                    </svg>
                </button>
            </div>
        </td>
    </tr>
    } @else {
    <tr class="rounded even:bg-neutral-100/25 flex flex-col md:flex-row justify-between">
        <td class="pl-4">
            <div class="flex gap-2 items-center w-full p-1">
                <div>
                    <svg [ngStyle]="{fill: colors.primary}" class="w-10 h-10" viewBox="0 0 40 41" fill="none"
                        xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M13.3333 33.8333C12.4167 33.8333 11.6319 33.5069 10.9792 32.8541C10.3264 32.2013 10 31.4166 10 30.5V25.5H15V21.75C14.0278 21.6944 13.1042 21.4791 12.2292 21.1041C11.3542 20.7291 10.5556 20.1666 9.83333 19.4166V17.5833H7.91667L2.5 12.1666C3.5 10.8888 4.73611 9.98607 6.20833 9.45829C7.68056 8.93051 9.16667 8.66663 10.6667 8.66663C11.4167 8.66663 12.1458 8.72218 12.8542 8.83329C13.5625 8.9444 14.2778 9.15274 15 9.45829V7.16663H35V28.8333C35 30.2222 34.5139 31.4027 33.5417 32.375C32.5694 33.3472 31.3889 33.8333 30 33.8333H13.3333ZM18.3333 25.5H28.3333V28.8333C28.3333 29.3055 28.4931 29.7013 28.8125 30.0208C29.1319 30.3402 29.5278 30.5 30 30.5C30.4722 30.5 30.8681 30.3402 31.1875 30.0208C31.5069 29.7013 31.6667 29.3055 31.6667 28.8333V10.5H18.3333V11.5L28.3333 21.5V23.8333H26L21.25 19.0833L20.9167 19.4166C20.5278 19.8055 20.1181 20.1527 19.6875 20.4583C19.2569 20.7638 18.8056 21 18.3333 21.1666V25.5ZM9.33333 14.25H13.1667V17.8333C13.5 18.0555 13.8472 18.2083 14.2083 18.2916C14.5694 18.375 14.9444 18.4166 15.3333 18.4166C15.9722 18.4166 16.5486 18.3194 17.0625 18.125C17.5764 17.9305 18.0833 17.5833 18.5833 17.0833L18.9167 16.75L16.5833 14.4166C15.7778 13.6111 14.875 13.0069 13.875 12.6041C12.875 12.2013 11.8056 12 10.6667 12C10.1111 12 9.58333 12.0416 9.08333 12.125C8.58333 12.2083 8.08333 12.3333 7.58333 12.5L9.33333 14.25ZM25 28.8333H13.3333V30.5H25.25C25.1667 30.25 25.1042 29.9861 25.0625 29.7083C25.0208 29.4305 25 29.1388 25 28.8333Z" />
                    </svg>
                </div>
                <div class="flex flex-col">
                    <span class="text-sm text-neutral-700 font-medium">{{unit.name}}</span>
                    <span class="text-xs text-neutral-500">Apoderado</span>
                </div>
            </div>
        </td>
        <td class="pr-4">
            <div class="md:gap-4 gap-2 flex md:flex-row flex-col-reverse md:items-center md:justify-end items-end p-1">
                <!-- <nx-toggle-switch [viewValues]="true" [values]="values"></nx-toggle-switch> -->
                <div class="flex gap-2 md:w-fit w-full ">
                    <button (click)="scannerCertificate(unit.id)"
                        class="b-secondary !bg-neutral-100 p-2 flex gap-2 items-center flex-1 md:flex-none justify-center">
                        <svg class="w-4 h-4 fill-neutral-700" viewBox="0 0 24 25" fill="none"
                            xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M3 21.5C2.45 21.5 1.97917 21.3042 1.5875 20.9125C1.19583 20.5208 1 20.05 1 19.5V7.5C1 6.95 1.19583 6.47917 1.5875 6.0875C1.97917 5.69583 2.45 5.5 3 5.5H6.15L8 3.5H14V5.5H8.875L7.05 7.5H3V19.5H19V10.5H21V19.5C21 20.05 20.8042 20.5208 20.4125 20.9125C20.0208 21.3042 19.55 21.5 19 21.5H3ZM19 7.5V5.5H17V3.5H19V1.5H21V3.5H23V5.5H21V7.5H19ZM11 18C12.25 18 13.3125 17.5625 14.1875 16.6875C15.0625 15.8125 15.5 14.75 15.5 13.5C15.5 12.25 15.0625 11.1875 14.1875 10.3125C13.3125 9.4375 12.25 9 11 9C9.75 9 8.6875 9.4375 7.8125 10.3125C6.9375 11.1875 6.5 12.25 6.5 13.5C6.5 14.75 6.9375 15.8125 7.8125 16.6875C8.6875 17.5625 9.75 18 11 18ZM11 16C10.3 16 9.70833 15.7583 9.225 15.275C8.74167 14.7917 8.5 14.2 8.5 13.5C8.5 12.8 8.74167 12.2083 9.225 11.725C9.70833 11.2417 10.3 11 11 11C11.7 11 12.2917 11.2417 12.775 11.725C13.2583 12.2083 13.5 12.8 13.5 13.5C13.5 14.2 13.2583 14.7917 12.775 15.275C12.2917 15.7583 11.7 16 11 16Z" />
                        </svg>
                        <span class="md:hidden text-neutral-700">Escanear</span>
                    </button>
                    <label [for]="unit.id+'_file'"
                        class="b-secondary !bg-neutral-100 p-2 flex gap-2 items-center flex-1 md:flex-none justify-center cursor-pointer">
                        <svg class="w-4 h-4 fill-neutral-700" viewBox="0 0 24 25" fill="none"
                            xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M6.5 20.5C4.98333 20.5 3.6875 19.975 2.6125 18.925C1.5375 17.875 1 16.5917 1 15.075C1 13.775 1.39167 12.6167 2.175 11.6C2.95833 10.5833 3.98333 9.93333 5.25 9.65C5.66667 8.11667 6.5 6.875 7.75 5.925C9 4.975 10.4167 4.5 12 4.5C13.95 4.5 15.6042 5.17917 16.9625 6.5375C18.3208 7.89583 19 9.55 19 11.5C20.15 11.6333 21.1042 12.1292 21.8625 12.9875C22.6208 13.8458 23 14.85 23 16C23 17.25 22.5625 18.3125 21.6875 19.1875C20.8125 20.0625 19.75 20.5 18.5 20.5H13C12.45 20.5 11.9792 20.3042 11.5875 19.9125C11.1958 19.5208 11 19.05 11 18.5V13.35L9.4 14.9L8 13.5L12 9.5L16 13.5L14.6 14.9L13 13.35V18.5H18.5C19.2 18.5 19.7917 18.2583 20.275 17.775C20.7583 17.2917 21 16.7 21 16C21 15.3 20.7583 14.7083 20.275 14.225C19.7917 13.7417 19.2 13.5 18.5 13.5H17V11.5C17 10.1167 16.5125 8.9375 15.5375 7.9625C14.5625 6.9875 13.3833 6.5 12 6.5C10.6167 6.5 9.4375 6.9875 8.4625 7.9625C7.4875 8.9375 7 10.1167 7 11.5H6.5C5.53333 11.5 4.70833 11.8417 4.025 12.525C3.34167 13.2083 3 14.0333 3 15C3 15.9667 3.34167 16.7917 4.025 17.475C4.70833 18.1583 5.53333 18.5 6.5 18.5H9V20.5H6.5Z" />
                        </svg>
                        <span class="md:hidden text-neutral-700">Subir</span>
                        <input class="hidden" type="file" [id]="unit.id+'_file'"
                            (change)="setFileCertificate(unit.id, $event)">
                    </label>
                </div>
            </div>
        </td>
    </tr>
    }
</ng-template>

@if(showScanner){
    <client-scanner (onSave)="saveScanner($event)" (onClose)="scannerCertificate(0, true)"></client-scanner>
}
